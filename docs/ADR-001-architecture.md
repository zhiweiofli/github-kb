# ADR-001: GitHub Knowledge Base Architecture

**Status**: Accepted
**Date**: 2026-01-29
**Decision Makers**: User + AIE Architect

---

## Context

用户需要一个基于文件系统的 GitHub 知识库管理技能，将 GitHub 转化为可搜索、可拥有的本地知识系统。

### 核心需求
- 使用 gh CLI 搜索 GitHub（repos/issues/PRs）
- 克隆选中的仓库到本地目录
- 维护人类可读的 Catalog 索引（CLAUDE.md）
- 本地文件检索（grep/glob/read）

### 非目标
- 无批量爬取或抓取
- 无向量数据库或嵌入
- 无私有仓库访问（除非显式授权）

---

## Decision

### 1. 目标平台
**Claude Code** (`.claude/skills/`)

### 2. 输出格式
**Project + Skill**
- 完整项目配置
- 独立可部署的技能包

### 3. 选中组件

#### From everything-claude-code (模式借鉴)
| 组件 | 来源 | 定制化 |
|------|------|--------|
| SKILL.md 结构 | `skills/tdd-workflow/SKILL.md` | 重写为 github-kb 工作流 |
| CLAUDE.md 结构 | `examples/CLAUDE.md` | 适配知识库场景 |

#### 新建组件
| 组件 | 用途 |
|------|------|
| `skills/github-kb/SKILL.md` | 主技能定义 |
| `commands/search-github.md` | GitHub 搜索快捷命令 |
| `commands/clone-repo.md` | 仓库克隆快捷命令 |
| `commands/update-catalog.md` | Catalog 更新快捷命令 |
| `rules/catalog-format.md` | Catalog 格式规范 |
| `rules/kb-management.md` | 知识库管理规则 |

### 4. 排除组件 (做减法)
| 组件 | 排除原因 |
|------|----------|
| agents/ | github-kb 不需要子代理委派 |
| hooks/ | 不需要自动化触发 |
| contexts/ | 不需要开发/审查模式切换 |
| mcp-configs/ | gh CLI 已满足需求 |
| skills/tdd-workflow/ | 非开发项目，不需要 TDD |
| rules/coding-style.md | 非开发项目，不需要代码规范 |

### 5. 宪法注入
| 规则 | 注入 | 理由 |
|------|------|------|
| Prime Directive | ✓ | 执行系统基础 |
| 验证优先 | ✓ | 确保搜索结果准确 |
| 零幻觉协议 | ✓ | 未知信息标记 UNKNOWN |
| TDD 铁律 | ✗ | 非开发项目 |
| 安全红线 | ✗ | 不涉及用户输入/API |

---

## Workflow Definition

### 四阶段工作流

```
1. DISCOVER (远程搜索)
   └── gh search repos/issues/prs

2. ACQUIRE (本地获取)
   └── git clone → kb_root/

3. RETRIEVE (深度检索)
   └── read / glob / grep

4. CATALOG (索引维护)
   └── 更新 CLAUDE.md
```

### Intent Routing

| 用户意图 | 触发关键词 | 执行阶段 |
|----------|------------|----------|
| 搜索仓库 | "找", "搜", "有没有", "替代方案" | DISCOVER |
| 搜索 Issues | "问题", "bug", "解决方案" | DISCOVER |
| 查看 PR | "最近更新", "合并了什么" | DISCOVER |
| 克隆仓库 | "克隆", "下载", "获取" | ACQUIRE |
| 查询本地 | "查看", "分析", "这个项目" | RETRIEVE |
| 更新索引 | "更新 catalog", "添加到知识库" | CATALOG |

---

## Directory Structure

```
projects/github-kb/
├── CLAUDE.md                      # 项目级配置 + 核心规则
├── README.md                      # 用户文档
├── docs/
│   └── ADR-001-architecture.md    # 本文档
└── .claude/
    ├── skills/
    │   └── github-kb/
    │       └── SKILL.md           # 主技能定义
    ├── commands/
    │   ├── search-github.md       # /search-github
    │   ├── clone-repo.md          # /clone-repo
    │   └── update-catalog.md      # /update-catalog
    └── rules/
        ├── catalog-format.md      # Catalog 格式规范
        └── kb-management.md       # 知识库管理规则
```

---

## Configuration

```yaml
kb_root: ./github-kb/repos/
catalog_file: CLAUDE.md
```

---

## Consequences

### Positive
- 简洁的项目结构（做减法）
- 清晰的工作流定义
- 核心宪法规则保障质量
- 可独立部署和复用

### Negative
- 无自动化触发（需手动执行命令）
- 无 MCP 深度集成（依赖 gh CLI）

### Risks
- gh CLI 需要预先认证
- 大型仓库克隆耗时

---

*Generated by AIE Workflow v2.5*
